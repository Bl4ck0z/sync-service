flowchart TD
    A[ðŸš€ PASO 5: Producer-Consumer] --> B[ðŸ“‹ Infraestructura Lista]
    B --> C[âœ… Redis + SQL Server + PostgreSQL]
    C --> D[ðŸ”„ Implementar Producer + Consumer]
    
    D --> E[ðŸ“¤ PRODUCER Process]
    D --> F[ðŸ“¥ CONSUMER Process]
    
    E --> G[ðŸ”„ Loop cada 10s]
    G --> H[ðŸ“… Redis.GET last_sync_timestamp]
    H --> I[ðŸ“¥ SQL Server: WHERE ULTIMA_MODIFICACION > last_sync]
    I --> J{Â¿Cambios nuevos?}
    
    J -->|âŒ NO| K[â„¹ï¸ Sin cambios - Sleep 10s]
    J -->|âœ… SI| L[ðŸ“® Redis.LPUSH change_queue]
    L --> M[ðŸ“… Redis.SET last_sync_timestamp]
    M --> K
    K --> G
    
    F --> N[ðŸ”„ Loop continuo]
    N --> O[ðŸ“¦ Redis.BRPOP change_queue]
    O --> P[ðŸ“Š Procesar batch de registros]
    P --> Q[ðŸ”€ UPSERT datos_vista]
    Q --> R[âœ… Confirmar procesado]
    R --> N
    
    S[ðŸ‘¥ NocoDB] -.->|READ| T[ðŸ“‹ datos_vista]
    S -.->|CRUD| U[âœï¸ datos_trabajo]
    T -.->|JOIN| U
    
    subgraph REDIS[ðŸ”¥ Redis - Ya funcionando]
        V[ðŸ“® change_queue]
        W[ðŸ“… last_sync_timestamp]
        X[âš¡ client_cache]
    end
    
    subgraph PG[ðŸ˜ PostgreSQL - Tablas creadas]
        T
        U
    end
    
    subgraph SQL[ðŸ¢ SQL Server - Vista disponible]
        Y[ðŸ“Š VW_VENTAS_SYNC]
    end
    
    L -.->|LPUSH| V
    O -.->|BRPOP| V
    H -.->|GET| W
    M -.->|SET| W
    
    I -.->|SELECT WHERE| Y
    Q -.->|UPSERT| T
